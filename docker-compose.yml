version: "3"
services:
    web:
        build: .
        environment:
            - FLASK_DEBUG=1
            - LISTEN_PORT=8081
            - APP_DEBUG=1
            - APP_PROFILER=1
            - APP_DEBUG_TOOLBAR=1
            - APP_DEBUG_TOOLBAR_SECRET_KEY=blah
        cap_add:
            - SYS_PTRACE
            - NET_ADMIN
            - SYS_ADMIN
        security_opt:
            - label:apparmor:unconfined
        ports:
            - "5000:5000"
            - "8080:8080"
            - "8081:8081"
            - "9191:9191"
            - "80:80"
            - "443:443"
        networks:
            - todo
        volumes:
            - ./src:/app
    db:
        image: mongo:3.0.15
        restart: always
        networks:
            - todo
        volumes:
            - "mongo-data:/data/db"


    consul:
      image: consul:0.7.5
      command: agent -server -client=0.0.0.0 -bootstrap -ui
      networks:
        - todo
      ports:
        - "8500:8500"
      restart: always

networks:
    todo:

volumes:
    mongo-data:
